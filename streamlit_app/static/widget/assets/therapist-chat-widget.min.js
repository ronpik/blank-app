/*! For license information please see therapist-chat-widget.min.js.LICENSE.txt */
(()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(){"use strict";e=function(){return r};var n,r={},a=Object.prototype,i=a.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function h(t,e,n,r){return Object.defineProperty(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r})}try{h({},"")}catch(n){h=function(t,e,n){return t[e]=n}}function u(t,e,r,a){var i=e&&e.prototype instanceof g?e:g,o=Object.create(i.prototype);return h(o,"_invoke",function(t,e,r){var a=1;return function(i,o){if(3===a)throw Error("Generator is already running");if(4===a){if("throw"===i)throw o;return{value:n,done:!0}}for(r.method=i,r.arg=o;;){var s=r.delegate;if(s){var c=E(s,r);if(c){if(c===d)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(1===a)throw a=4,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=3;var l=p(t,e,r);if("normal"===l.type){if(a=r.done?4:2,l.arg===d)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(a=4,r.method="throw",r.arg=l.arg)}}}(t,r,new T(a||[])),!0),o}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}r.wrap=u;var d={};function g(){}function f(){}function m(){}var b={};h(b,s,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(j([])));y&&y!==a&&i.call(y,s)&&(b=y);var w=m.prototype=g.prototype=Object.create(b);function x(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function k(e,n){function r(a,o,s,c){var l=p(e[a],e,o);if("throw"!==l.type){var h=l.arg,u=h.value;return u&&"object"==t(u)&&i.call(u,"__await")?n.resolve(u.__await).then((function(t){r("next",t,s,c)}),(function(t){r("throw",t,s,c)})):n.resolve(u).then((function(t){h.value=t,s(h)}),(function(t){return r("throw",t,s,c)}))}c(l.arg)}var a;h(this,"_invoke",(function(t,e){function i(){return new n((function(n,a){r(t,e,n,a)}))}return a=a?a.then(i,i):i()}),!0)}function E(t,e){var r=e.method,a=t.i[r];if(a===n)return e.delegate=null,"throw"===r&&t.i.return&&(e.method="return",e.arg=n,E(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),d;var i=p(a,t.i,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,d;var o=i.arg;return o?o.done?(e[t.r]=o.value,e.next=t.n,"return"!==e.method&&(e.method="next",e.arg=n),e.delegate=null,d):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function O(t){this.tryEntries.push(t)}function L(t){var e=t[4]||{};e.type="normal",e.arg=n,t[4]=e}function T(t){this.tryEntries=[[-1]],t.forEach(O,this),this.reset(!0)}function j(e){if(null!=e){var r=e[s];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,o=function t(){for(;++a<e.length;)if(i.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=n,t.done=!0,t};return o.next=o}}throw new TypeError(t(e)+" is not iterable")}return f.prototype=m,h(w,"constructor",m),h(m,"constructor",f),f.displayName=h(m,l,"GeneratorFunction"),r.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,h(t,l,"GeneratorFunction")),t.prototype=Object.create(w),t},r.awrap=function(t){return{__await:t}},x(k.prototype),h(k.prototype,c,(function(){return this})),r.AsyncIterator=k,r.async=function(t,e,n,a,i){void 0===i&&(i=Promise);var o=new k(u(t,e,n,a),i);return r.isGeneratorFunction(e)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},x(w),h(w,l,"Generator"),h(w,s,(function(){return this})),h(w,"toString",(function(){return"[object Generator]"})),r.keys=function(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}},r.values=j,T.prototype={constructor:T,reset:function(t){if(this.prev=this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(L),!t)for(var e in this)"t"===e.charAt(0)&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=n)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n){o.type="throw",o.arg=t,e.next=n}for(var a=e.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i[4],s=this.prev,c=i[1],l=i[2];if(-1===i[0])return r("end"),!1;if(!c&&!l)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<c)return this.method="next",this.arg=n,r(c),!0;if(s<l)return r(l),!1}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r[0]>-1&&r[0]<=this.prev&&this.prev<r[2]){var a=r;break}}a&&("break"===t||"continue"===t)&&a[0]<=e&&e<=a[2]&&(a=null);var i=a?a[4]:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a[2],d):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n[2]===t)return this.complete(n[4],n[3]),L(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n[0]===t){var r=n[4];if("throw"===r.type){var a=r.arg;L(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={i:j(t),r:e,n:r},"next"===this.method&&(this.arg=n),d}},r}function n(t,e,n,r,a,i,o){try{var s=t[i](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,a)}function r(t){return function(){var e=this,r=arguments;return new Promise((function(a,i){var o=t.apply(e,r);function s(t){n(o,a,i,s,c,"next",t)}function c(t){n(o,a,i,s,c,"throw",t)}s(void 0)}))}}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){o(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(e,n,r){return(n=function(e){var n=function(e){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}(n))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}!function(){"use strict";var t={apiBase:"",primaryColor:"#6B4BB5",secondaryColor:"#FFFFFF",position:"bottom-right",initialState:"collapsed",placeholder:"שאל שאלה את ד״ר רוני...",therapistAvatar:"assets/therapist.svg",userAvatar:"assets/user.svg",title:"Therapist Chat",loadingMessage:"Thinking...",errorMessage:"Sorry, something went wrong. Please try again.",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif',enableMarkdown:!0,language:"he",forceRTL:!1},n={isOpen:!1,threadId:null,messages:[],isLoading:!1,config:i({},t),elements:{},isRTL:!0},a=null;function o(){return s.apply(this,arguments)}function s(){return(s=r(e().mark((function t(){var r;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.config.enableMarkdown){t.next=2;break}return t.abrupt("return",null);case 2:return t.prev=2,t.next=5,new Promise((function(t,e){try{if(window.marked)return console.log("Marked library already loaded:",window.marked),void t(window.marked);console.log("Loading marked from CDN...");var n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/marked@5.1.0/marked.min.js",n.async=!0,n.onload=function(){console.log("Marked loaded from CDN:",window.marked),t(window.marked)},n.onerror=function(t){console.error("Failed to load marked.js library from CDN:",t),e(new Error("Failed to load marked library"))},document.head.appendChild(n)}catch(t){console.error("Error in loadMarkedLibrary:",t),e(t)}}));case 5:return(r=t.sent).use({gfm:!0,breaks:!0,silent:!0}),a=r,t.abrupt("return",r);case 11:return t.prev=11,t.t0=t.catch(2),console.error("Error initializing marked:",t.t0),t.abrupt("return",null);case 15:case"end":return t.stop()}}),t,null,[[2,11]])})))).apply(this,arguments)}function c(){var e=document.currentScript||document.querySelector('script[id="therapist-chat-script"]'),r=window.TherapistChatConfig||{};if(e)for(var a in t){var o=e.dataset[a.toLowerCase()];void 0!==o&&("true"===o?o=!0:"false"===o&&(o=!1),r[a]=o)}n.config=i(i({},t),r),n.isRTL=n.config.forceRTL||"he"===n.config.language.toLowerCase()}function l(){return h.apply(this,arguments)}function h(){return(h=r(e().mark((function t(){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c(),!n.config.enableMarkdown){t.next=4;break}return t.next=4,o();case 4:n.isOpen="open"===n.config.initialState,u(),e=void 0,r=void 0,a=void 0,i=void 0,s=void 0,null===(e=n.elements.chatButton)||void 0===e||e.addEventListener("click",p),null===(r=n.elements.closeButton)||void 0===r||r.addEventListener("click",d),null===(a=n.elements.sendButton)||void 0===a||a.addEventListener("click",y),null===(i=n.elements.input)||void 0===i||i.addEventListener("keypress",(function(t){"Enter"!==t.key||t.shiftKey||(t.preventDefault(),y())})),null===(s=n.elements.input)||void 0===s||s.addEventListener("input",(function(){var t=n.elements.input;t.style.height="auto",t.style.height=t.scrollHeight+"px"})),console.log("Therapist Chat Widget initialized with config:",n.config),n.isOpen?p():d();case 9:case"end":return t.stop()}var e,r,a,i,s}),t)})))).apply(this,arguments)}function u(){var t="therapist-chat-widget-container";if(!document.getElementById(t)){var e=document.createElement("div");e.id=t;var r="therapist-chat-widget";n.isOpen||(r+=" therapist-chat-collapsed"),n.isRTL&&(r+=" therapist-chat-rtl"),e.className=r,e.style.setProperty("--primary-color",n.config.primaryColor),e.style.setProperty("--secondary-color",n.config.secondaryColor),e.style.setProperty("--font-family",n.config.fontFamily),e.innerHTML='\n      <button class="therapist-chat-button" title="'.concat(n.config.title,'" aria-label="Open chat">\n        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>\n        </svg>\n      </button>\n      <div class="therapist-chat-window">\n        <div class="therapist-chat-header">\n          <span class="therapist-chat-title">').concat(n.config.title,'</span>\n          <button class="therapist-chat-close" aria-label="Close chat">×</button>\n        </div>\n        <div class="therapist-chat-messages-area"></div>\n        <div class="therapist-chat-input-area">\n          <textarea class="therapist-chat-input" placeholder="').concat(n.config.placeholder,'" aria-label="Chat input"></textarea>\n          <button class="therapist-chat-send-button" aria-label="Send message">\n            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n              <line x1="22" y1="2" x2="11" y2="13"></line>\n              <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>\n            </svg>\n          </button>\n        </div>\n      </div>\n    '),document.body.appendChild(e),n.elements.widgetContainer=e,n.elements.chatButton=e.querySelector(".therapist-chat-button"),n.elements.chatWindow=e.querySelector(".therapist-chat-window"),n.elements.closeButton=e.querySelector(".therapist-chat-close"),n.elements.messagesArea=e.querySelector(".therapist-chat-messages-area"),n.elements.input=e.querySelector(".therapist-chat-input"),n.elements.sendButton=e.querySelector(".therapist-chat-send-button"),function(){var t="therapist-chat-styles";if(!document.getElementById(t)){var e=document.createElement("style");e.id=t,e.textContent="\n      .therapist-chat-widget {\n        position: fixed;\n        bottom: 20px;\n        right: 20px;\n        font-family: var(--font-family);\n        z-index: 99999;\n      }\n      /* RTL base styles */\n      .therapist-chat-rtl {\n        direction: rtl;\n      }\n      .therapist-chat-rtl .therapist-chat-header {\n        /* Title and close button alignment is handled by flexbox properties */\n      }\n      .therapist-chat-rtl .therapist-chat-title {\n        /* text-align: right; /* Flexbox handles this */\n      }\n      .therapist-chat-rtl .therapist-chat-messages-area {\n        /* text-align: right; /* Bubbles will handle their own text-align */\n      }\n      .therapist-chat-rtl .therapist-chat-message.user-message {\n        margin-left: 0; /* Override LTR default */\n        margin-right: auto; /* Push to the left in RTL context */\n        /* flex-direction: row-reverse; /* Already set for user messages */\n      }\n      .therapist-chat-rtl .therapist-chat-message.assistant-message {\n         /* Avatar on the right, bubble on the left in RTL context */\n         flex-direction: row-reverse; /* Make assistant messages behave like user messages in LTR */\n      }\n\n      /* Avatars in RTL */\n      .therapist-chat-rtl .therapist-chat-message .therapist-chat-avatar {\n        /* Default LTR: user avatar is on the right of its bubble (left of overall message), assistant avatar on left of its bubble */\n        /* RTL goal: user avatar on left of its bubble (right of overall message), assistant avatar on right of its bubble */\n      }\n\n      .therapist-chat-rtl .therapist-chat-message.user-message .therapist-chat-avatar {\n        margin-left: 0; /* Original: margin-left: 10px for LTR user */\n        margin-right: 10px; /* Original: margin-right: 0 for LTR user */\n      }\n      .therapist-chat-rtl .therapist-chat-message.assistant-message .therapist-chat-avatar {\n        margin-left: 10px; /* Original: margin-right: 10px for LTR assistant */\n        margin-right: 0;   /* Original: margin-left: 0 for LTR assistant */\n      }\n\n      .therapist-chat-rtl .therapist-chat-message-bubble {\n        direction: rtl; /* Ensure text within bubble flows RTL */\n        text-align: right; /* Align text to the right within the bubble */\n      }\n      /* Ensure markdown content also respects RTL */\n      .therapist-chat-rtl .therapist-chat-message-bubble p,\n      .therapist-chat-rtl .therapist-chat-message-bubble ul,\n      .therapist-chat-rtl .therapist-chat-message-bubble ol,\n      .therapist-chat-rtl .therapist-chat-message-bubble h1,\n      .therapist-chat-rtl .therapist-chat-message-bubble h2,\n      .therapist-chat-rtl .therapist-chat-message-bubble h3,\n      .therapist-chat-rtl .therapist-chat-message-bubble h4,\n      .therapist-chat-rtl .therapist-chat-message-bubble h5,\n      .therapist-chat-rtl .therapist-chat-message-bubble h6,\n      .therapist-chat-rtl .therapist-chat-message-bubble blockquote {\n          direction: rtl;\n          text-align: right;\n      }\n      .therapist-chat-rtl .therapist-chat-message-bubble ul,\n      .therapist-chat-rtl .therapist-chat-message-bubble ol {\n        padding-left: 0; /* Remove default LTR padding */\n        padding-right: 1.5em; /* Add padding to the right for RTL lists */\n      }\n      .therapist-chat-rtl .therapist-chat-message-bubble blockquote {\n        border-left: none;\n        border-right: 3px solid #ccc;\n        padding-left: 0;\n        padding-right: 1em;\n      }\n\n      .therapist-chat-rtl .therapist-chat-input-area {\n        flex-direction: row-reverse; /* Input field on right, send button on left */\n      }\n      .therapist-chat-rtl .therapist-chat-input {\n        direction: rtl; /* Ensure text input flows RTL */\n        text-align: right; /* Align placeholder and typed text to the right */\n        margin-left: 10px; /* Space between input and send button */\n        margin-right: 0;\n      }\n      .therapist-chat-rtl .therapist-chat-send-button {\n         /* Default styling fine, position adjusted by flex-direction on parent */\n      }\n\n      .therapist-chat-widget.therapist-chat-collapsed .therapist-chat-window {\n        display: none;\n      }\n      .therapist-chat-widget:not(.therapist-chat-collapsed) .therapist-chat-button {\n        display: none;\n      }\n      .therapist-chat-button {\n        width: 60px;\n        height: 60px;\n        border-radius: 50%;\n        background-color: var(--primary-color);\n        color: var(--secondary-color);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        transition: transform 0.2s ease-in-out;\n        border: none;\n      }\n      .therapist-chat-button:hover {\n        transform: scale(1.1);\n      }\n      .therapist-chat-window {\n        width: 370px;\n        max-height: 600px;\n        height: 80vh; /* Responsive height */\n        background-color: var(--secondary-color);\n        border-radius: 12px;\n        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n      }\n      .therapist-chat-header {\n        background-color: var(--primary-color);\n        color: var(--secondary-color);\n        padding: 12px 20px;\n        border-radius: 12px 12px 0 0;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n      .therapist-chat-title {\n        font-weight: 600;\n        font-size: 1.1em;\n      }\n      .therapist-chat-close {\n        background: none;\n        border: none;\n        color: var(--secondary-color);\n        font-size: 24px;\n        cursor: pointer;\n        padding: 0;\n        line-height: 1;\n      }\n      .therapist-chat-messages-area {\n        flex-grow: 1;\n        overflow-y: auto;\n        padding: 15px;\n        background-color: #f9f9f9;\n      }\n      .therapist-chat-message {\n        display: flex; \n        margin-bottom: 12px; \n        max-width: 85%;\n      }\n      .therapist-chat-message.user-message { \n        margin-left: auto; \n        flex-direction: row-reverse; \n      }\n      .therapist-chat-avatar {\n        width: 32px; \n        height: 32px; \n        border-radius: 50%; \n        background-color: #ccc; \n        margin-right: 10px; \n        background-size: cover; \n        background-position: center;\n        flex-shrink: 0;\n      }\n      .therapist-chat-message.user-message .therapist-chat-avatar { \n        margin-left: 10px; \n        margin-right: 0; \n      }\n      .therapist-chat-message-bubble {\n        padding: 10px 14px; \n        border-radius: 18px; \n        font-size: 0.95em; \n        line-height: 1.4;\n        overflow-wrap: break-word;\n        word-wrap: break-word;\n        word-break: break-word;\n      }\n      .therapist-chat-message.user-message .therapist-chat-message-bubble {\n        background-color: var(--primary-color); \n        color: var(--secondary-color);\n      }\n      .therapist-chat-message.assistant-message .therapist-chat-message-bubble {\n        background-color: #e5e5ea; \n        color: #000;\n      }\n      \n      /* Markdown styling */\n      .therapist-chat-message-bubble p {\n        margin: 0 0 0.75em 0;\n      }\n      .therapist-chat-message-bubble p:last-child {\n        margin-bottom: 0;\n      }\n      .therapist-chat-message-bubble h1, \n      .therapist-chat-message-bubble h2, \n      .therapist-chat-message-bubble h3, \n      .therapist-chat-message-bubble h4, \n      .therapist-chat-message-bubble h5, \n      .therapist-chat-message-bubble h6 {\n        margin-top: 0.5em;\n        margin-bottom: 0.5em;\n        font-weight: 600;\n      }\n      .therapist-chat-message-bubble h1 { font-size: 1.4em; }\n      .therapist-chat-message-bubble h2 { font-size: 1.3em; }\n      .therapist-chat-message-bubble h3 { font-size: 1.2em; }\n      .therapist-chat-message-bubble h4 { font-size: 1.1em; }\n      .therapist-chat-message-bubble h5 { font-size: 1em; }\n      .therapist-chat-message-bubble h6 { font-size: 0.9em; }\n      \n      .therapist-chat-message-bubble ul, \n      .therapist-chat-message-bubble ol {\n        margin: 0.5em 0;\n        padding-left: 1.5em;\n      }\n      \n      .therapist-chat-message-bubble code {\n        background-color: rgba(0, 0, 0, 0.05);\n        padding: 0.2em 0.4em;\n        border-radius: 3px;\n        font-family: SFMono-Regular, Consolas, 'Liberation Mono', Menlo, monospace;\n        font-size: 0.9em;\n      }\n      \n      .therapist-chat-message-bubble pre {\n        background-color: rgba(0, 0, 0, 0.05);\n        padding: 0.5em;\n        border-radius: 5px;\n        overflow-x: auto;\n        margin: 0.5em 0;\n      }\n      \n      .therapist-chat-message-bubble pre code {\n        background-color: transparent;\n        padding: 0;\n        border-radius: 0;\n        font-size: 0.9em;\n      }\n      \n      .therapist-chat-message-bubble blockquote {\n        border-left: 3px solid #ccc;\n        margin: 0.5em 0;\n        padding-left: 1em;\n        color: #666;\n      }\n      \n      .therapist-chat-message-bubble a {\n        color: inherit;\n        text-decoration: underline;\n      }\n      \n      .therapist-chat-message.user-message .therapist-chat-message-bubble a {\n        color: var(--secondary-color);\n      }\n      \n      .therapist-chat-loading-indicator, .therapist-chat-error-message {\n        text-align: center; \n        padding: 10px; \n        color: #777; \n        font-style: italic;\n      }\n      .therapist-chat-input-area {\n        padding: 10px 15px;\n        border-top: 1px solid #e0e0e0;\n        background-color: var(--secondary-color);\n        display: flex;\n        align-items: center;\n      }\n      .therapist-chat-input {\n        flex-grow: 1;\n        padding: 10px 15px;\n        border: 1px solid #ccc;\n        border-radius: 20px;\n        resize: none;\n        font-size: 0.95em;\n        min-height: 20px;\n        max-height: 100px;\n        overflow-y: auto;\n        margin-right: 10px;\n        font-family: inherit;\n      }\n      .therapist-chat-send-button {\n        background-color: var(--primary-color);\n        color: var(--secondary-color);\n        border: none;\n        padding: 8px;\n        border-radius: 50%;\n        cursor: pointer;\n        width: 36px;\n        height: 36px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        flex-shrink: 0;\n      }\n      .therapist-chat-send-button:hover {\n        opacity: 0.9;\n      }\n      .therapist-chat-send-button:disabled {\n        background-color: #ccc;\n        cursor: not-allowed;\n      }\n      \n      /* Animation for messages */\n      @keyframes message-fade-in {\n        from { opacity: 0; transform: translateY(10px); }\n        to { opacity: 1; transform: translateY(0); }\n      }\n      .therapist-chat-message {\n        animation: message-fade-in 0.3s ease-out;\n      }\n    ",document.head.appendChild(e)}}()}}function p(){var t,e;n.isOpen=!0,null===(t=n.elements.widgetContainer)||void 0===t||t.classList.remove("therapist-chat-collapsed"),null===(e=n.elements.input)||void 0===e||e.focus()}function d(){var t;n.isOpen=!1,null===(t=n.elements.widgetContainer)||void 0===t||t.classList.add("therapist-chat-collapsed")}function g(t,e){var r=document.createElement("div");r.className="therapist-chat-message ".concat(e,"-message");var i=document.createElement("div");i.className="therapist-chat-avatar";var o="user"===e?n.config.userAvatar:n.config.therapistAvatar;i.style.backgroundImage="url(".concat(o,")");var s=document.createElement("div");s.className="therapist-chat-message-bubble",n.config.enableMarkdown&&a&&"assistant"===e?s.innerHTML=a.parse(t):s.innerHTML=t.replace(/\n/g,"<br>"),r.appendChild(i),r.appendChild(s),n.elements.messagesArea.appendChild(r),v()}function f(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(m(),t){var e=document.createElement("div");e.className="therapist-chat-loading-indicator",e.textContent=n.config.loadingMessage,n.elements.messagesArea.appendChild(e),n.elements.loadingIndicator=e,v()}}function m(){var t;null===(t=n.elements.loadingIndicator)||void 0===t||t.remove(),delete n.elements.loadingIndicator}function b(t){m();var e=document.createElement("div");e.className="therapist-chat-error-message",e.textContent=t||n.config.errorMessage,n.elements.messagesArea.appendChild(e),v()}function v(){n.elements.messagesArea.scrollTop=n.elements.messagesArea.scrollHeight}function y(){return w.apply(this,arguments)}function w(){return(w=r(e().mark((function t(){var r,a,i,o,s,c,l,h;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((r=n.elements.input.value.trim())&&!n.isLoading){t.next=3;break}return t.abrupt("return");case 3:return n.elements.input.value="",n.elements.input.style.height="auto",g(r,"user"),n.isLoading=!0,n.elements.sendButton.disabled=!0,f(!0),t.prev=9,a=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/api",i=n.config.apiBase||a,o=i.includes("://")?"".concat(i,"/chat"):"http://".concat(i,"/chat"),console.log("Sending chat request to: ".concat(o)),s={message:r},n.threadId&&(s.thread_id=n.threadId),t.next=18,fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Origin:window.location.origin},mode:"cors",credentials:"same-origin",body:JSON.stringify(s)});case 18:if(c=t.sent,m(),c.ok){t.next=25;break}return t.next=23,c.json().catch((function(){return{detail:"API error: ".concat(c.status)}}));case 23:throw l=t.sent,new Error(l.detail||"API error: ".concat(c.status));case 25:return t.next=27,c.json();case 27:h=t.sent,n.threadId=h.thread_id,g(h.response,"assistant"),t.next=36;break;case 32:t.prev=32,t.t0=t.catch(9),console.error("TherapistChat API Error:",t.t0),b(t.t0.message);case 36:return t.prev=36,n.isLoading=!1,n.elements.sendButton.disabled=!1,n.elements.input.focus(),t.finish(36);case 41:case"end":return t.stop()}}),t,null,[[9,32,36,41]])})))).apply(this,arguments)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",l):l(),window.TherapistChat={init:function(t){document.getElementById("therapist-chat-widget-container")?console.warn("Therapist Chat Widget already initialized. Re-init not fully supported yet."):l(t)},open:p,close:d}}()})();